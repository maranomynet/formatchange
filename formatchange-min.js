/* FormatChange  -- (c) 2012-2015 Hugsmi√∞jan ehf.   @license MIT/GPL */
!function(){"use strict";var e=window,t=document,r=!!e.addEventListener,n=Object.create||function(e){var t=function(){};return t.prototype=e,new t},a=function(e,t){var r=this;return this instanceof a?(t=t||{},t.elmTagName&&(r.elmTagName=t.elmTagName),t.elmId&&(r.elmId=t.elmId),"defer"in t&&(r.defer=t.defer),r.formatGroups=e?e:n(r.formatGroups),r.media={},r._callbacks=[],r._$hdl=function(){r._getFormat()},!r.defer&&r.start(),void 0):new a(e,t)};a.prototype={elmTagName:"del",elmId:"mediaformat",defer:!1,formatGroups:{},isRunning:function(){return this._on},start:function(n){var a=this;if(!a._on){var i=a._elm=t.createElement(a.elmTagName||"del"),o=i.style;o.position="absolute",o.visibility=o.overflow="hidden",o.width=o.height=0,i.id=a.elmId||"mediaformat",t.body.appendChild(i),a._on=!0,r?e.addEventListener("resize",a._$hdl):e.attachEvent("onresize",a._$hdl),a.refresh(n)}},stop:function(){var t=this,n=t._elm;t._on&&(r?e.removeEventListener("resize",t._$hdl):e.detachEvent("onresize",t._$hdl),n.parentNode.removeChild(n),delete t._elm,t._on=!1)},refresh:function(e){e&&(this.oldFormat=null),this._getFormat(),this._updateFlags()},subscribe:function(e){var t=this;e&&(t.unsubscribe(e),t._callbacks.push(e),t._on&&!t._triggering&&e(t.media))},unsubscribe:function(e){for(var t,r=this._callbacks,n=0;t=r[n];n++)if(t===e){r.splice(n,1);break}},_on:!1,_updateFlags:function(){var e=this,t=e.media,r=e.formatGroups;for(var n in r){var a=r[n],i=!(!a||!a[t.is]),o=!(!a||!a[t.was]);t["is"+n]=i,t["was"+n]=o,t["became"+n]=i&&!o,t["left"+n]=!i&&o,!a&&delete r[n]}},_getFormat:function(){var t=this,r=t.media,n=t.oldFormat,a=t._elm,i=e.getComputedStyle,o=i&&i(a,":after").getPropertyValue("content");if(o&&"none"!==o||(o=(i?i(a,null).getPropertyValue("font-family"):a.currentStyle.fontFamily)||""),o=o.replace(/['"]/g,""),o!==n){r.is=r.format=o,r.was=r.lastFormat=n,t.oldFormat=o,t._updateFlags(),t._triggering=!0;for(var l,s=0;l=t._callbacks[s];s++)l(r);t._triggering=!1}}},a.jQueryPlugin=function(t,r){var n={};t.formatChange=function(i,o){o=o||{};var l=o.eventName||r||"formatchange";if(!n[l]){var s=n[l]=new a(i,o),d="_$triggered";s.subscribe(function(r){t(e).trigger(l,[r])}),t.event.special[l]={add:function(r){setTimeout(function(){var n=r.handler;s._on&&!n[d]&&n.call(e,t.Event(l),s.media)},0)},handle:function(e){var t=e.handleObj.handler;return t[d]=!0,t.apply(this,arguments)}}}return s}},"object"==typeof module&&"object"==typeof module.exports?module.exports=a:(e.FormatChange=a,e.jQuery&&a.jQueryPlugin(e.jQuery))}();
