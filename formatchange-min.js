/* FormatChange  -- (c) 2012-2016 Hugsmi√∞jan ehf.   @license MIT/GPL */
!function(){"use strict";var e=window,t=!!e.addEventListener,n=Object.create||function(e){var t=function(){};return t.prototype=e,new t},r=function(e,t){var a=this;return this instanceof r?(t=t||{},t.window&&(a.win=t.window),t.elmTagName&&(a.elmTagName=t.elmTagName),t.elmId&&(a.elmId=t.elmId),"defer"in t&&(a.defer=t.defer),a.formatGroups=e||n(a.formatGroups),a.media={},a._callbacks=[],a._$hdl=function(){a._getFormat()},!a.defer&&a.start(),void 0):new r(e,t)};r.prototype={elmTagName:"del",elmId:"mediaformat",defer:!1,win:e,formatGroups:{},isRunning:function(){return this._on},start:function(e){var n=this;if(!n._on){var r=n.win,a=r.document,i=n._elm=a.createElement(n.elmTagName||"del"),o=i.style;o.position="absolute",o.visibility=o.overflow="hidden",o.width=o.height=0,i.id=n.elmId||"mediaformat",a.body.appendChild(i),n._on=!0,t?r.addEventListener("resize",n._$hdl):r.attachEvent("onresize",n._$hdl),n.refresh(e)}},stop:function(){var e=this,n=e._elm;e._on&&(t?e.win.removeEventListener("resize",e._$hdl):e.win.detachEvent("onresize",e._$hdl),n.parentNode.removeChild(n),delete e._elm,e._on=!1)},refresh:function(e){e&&(this.oldFormat=null),this._getFormat(),this._updateFlags()},subscribe:function(e){var t=this;e&&(t.unsubscribe(e),t._callbacks.push(e),t._on&&!t._triggering&&e(t.media))},unsubscribe:function(e){for(var t,n=this._callbacks,r=0;t=n[r];r++)if(t===e){n.splice(r,1);break}},_on:!1,_updateFlags:function(){var e=this,t=e.media,n=e.formatGroups;for(var r in n){var a=n[r],i=!(!a||!a[t.is]),o=!(!a||!a[t.was]);t["is"+r]=i,t["was"+r]=o,t["became"+r]=i&&!o,t["left"+r]=!i&&o,!a&&delete n[r]}},_getFormat:function(){var e=this,t=e.media,n=e.oldFormat,r=e._elm,a=e.win.getComputedStyle,i=a&&a(r,":after").getPropertyValue("content");if(i&&"none"!==i||(i=(a?a(r,null).getPropertyValue("font-family"):r.currentStyle.fontFamily)||""),i=i.replace(/['"]/g,""),i!==n){t.is=t.format=i,t.was=t.lastFormat=n,e.oldFormat=i,e._updateFlags(),e._triggering=!0;for(var o,l=0;o=e._callbacks[l];l++)o(t);e._triggering=!1}}},r.jQueryPlugin=function(e,t){var n={};e.formatChange=function(a,i){i=i||{};var o=i.eventName||t||"formatchange",l=n[o];if(!l){l=n[o]=new r(a,i);var s="_$triggered";l.subscribe(function(t){e(l.win).trigger(o,[t])}),e.event.special[o]={add:function(t){setTimeout(function(){var n=t.handler;l._on&&!n[s]&&n.call(l.win,e.Event(o),l.media)},0)},handle:function(e){var t=e.handleObj.handler;return t[s]=!0,t.apply(this,arguments)}}}return l}},"object"==typeof module&&"object"==typeof module.exports?module.exports=r:e.FormatChange=r;var a=e.jQuery;a&&!a.formatChange&&r.jQueryPlugin(a)}();

