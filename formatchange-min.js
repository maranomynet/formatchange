/* FormatChange  -- (c) 2012-2016 Hugsmi√∞jan ehf.   @license MIT/GPL */
!function(){"use strict";var e=window,t=!!e.addEventListener,n=Object.create||function(e){var t=function(){};return t.prototype=e,new t},a=function(e,t){var r=this;return this instanceof a?(t=t||{},r.win=t.win||r.win,r.elm=t.elm,t.elmTagName&&(r.elmTagName=t.elmTagName),t.elmId&&(r.elmId=t.elmId),"manual"in t&&(r.manual=t.manual),"defer"in t&&(r.defer=t.defer),r.formatGroups=e||n(r.formatGroups),r.media={},r._callbacks=[],r._$hdl=function(){r._getFormat()},!r.defer&&r.start(),void 0):new a(e,t)};a.prototype={elmTagName:"del",elmId:"mediaformat",manual:!1,defer:!1,win:e,formatGroups:{},isRunning:function(){return this._on},start:function(e){var n=this;if(!n._on){var a=n.win;if(!n.elm){var r=a.document,i=n.elmId||"mediaformat",o=n.elm=r.getElementById(i);if(!o){o=n.elm=r.createElement(n.elmTagName||"del");var l=o.style;l.position="absolute",l.visibility=l.overflow="hidden",l.border=l.padding=l.margin=l.width=l.height=0,o.id=i,o._isMine=!0,r.body.appendChild(o)}}n._on=!0,n.manual||(t?a.addEventListener("resize",n._$hdl):a.attachEvent("onresize",n._$hdl)),n.refresh(e)}},stop:function(){var e=this,n=e.elm;e._on&&(e.manual||(t?e.win.removeEventListener("resize",e._$hdl):e.win.detachEvent("onresize",e._$hdl)),n._isMine&&(n.parentNode.removeChild(n),delete e.elm),e._on=!1)},refresh:function(e){var t=this;return e&&(t.oldFormat=null),t._on&&(t._getFormat(),t._updateFlags()),t._on},subscribe:function(e){var t=this;e&&(t.unsubscribe(e),t._callbacks.push(e),t._on&&!t._triggering&&e(t.media))},unsubscribe:function(e){for(var t,n=this._callbacks,a=0;t=n[a];a++)if(t===e){n.splice(a,1);break}},_on:!1,_updateFlags:function(){var e=this,t=e.media,n=e.formatGroups;for(var a in n){var r=n[a],i=!(!r||!r[t.is]),o=!(!r||!r[t.was]);t["is"+a]=i,t["was"+a]=o,t["became"+a]=i&&!o,t["left"+a]=!i&&o,!r&&delete n[a]}},_getFormat:function(){var e=this,t=e.media,n=e.oldFormat,a=e.elm,r=e.win.getComputedStyle,i=r&&r(a,":after").getPropertyValue("content");if(i&&"none"!==i||(i=(r?r(a,null).getPropertyValue("font-family"):a.currentStyle.fontFamily)||""),i=i.replace(/['"]/g,""),i!==n){t.is=t.format=i,t.was=t.lastFormat=n,e.oldFormat=i,e._updateFlags(),e._triggering=!0;for(var o,l=0;o=e._callbacks[l];l++)o(t);e._triggering=!1}}},a.jQueryPlugin=function(t,n){t.formatChange=function(r,i){i=i||{};var o=i.win||a.prototype.win||e,l="$formatchange_jquery_instances",m=o[l];m||(m=o[l]={});var s=i.eventName||n||"formatchange",u=m[s];if(!u){u=m[s]=new a(r,i);var d="_$triggered";u.subscribe(function(e){t(o).trigger(s,[e])}),t.event.special[s]={add:function(e){setTimeout(function(){var n=e.handler;u._on&&!n[d]&&n.call(o,t.Event(s),u.media)},0)},handle:function(e){var t=e.handleObj.handler;return t[d]=!0,t.apply(this,arguments)}}}return u}},"object"==typeof module&&"object"==typeof module.exports?module.exports=a:e.FormatChange=a;var r=e.jQuery;r&&!r.formatChange&&a.jQueryPlugin(r)}();

